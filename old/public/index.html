<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <title>St√§mme Huuck</title>
    <script src="/bundle.js"></script>
</head>

<body>

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        iframe {
            width: 100%;
            height: 1000px;
            margin-bottom: 20px;
        }

        .tbl {
            width: 100%;
        }

        table tr td,
        table tr th {
            padding: 5px 8px;
            border: 1px solid black;
        }
    </style>

    <button onclick="reloadFrame()">Reload Content</button>
    <iframe src="/content.html" frameborder="0" id="contentFrame" onload="initFrame()"></iframe>
    <br><br>

    <script>
        function addQueue(event) {
            socket.emit('add queue', event.querySelector('input').value);
            event.querySelector('input').value = "";
            return false;
        }
        function clickElem(event) {
            socket.emit('click', event.querySelector('input').value);
            event.querySelector('input').value = "";
            return false;
        }

        function reloadFrame() {
            document.getElementById('contentFrame').contentWindow.location.reload();
        }

        function initFrame() {
            let w = document.getElementById('contentFrame').contentWindow;
            w.document.querySelectorAll('[href]').forEach(a => {
                a.addEventListener('click', function(event) {
                    event.preventDefault();
                    if (a.id) {
                        socket.emit('click', '#' + a.id);
                    } else {
                        socket.emit('click', getSelectorForElement(a));
                    }
                    
                    return false;
                });
            });
        }

        function getSelectorForElement (elem) {
            let path;
            while (elem) {
                let subSelector = elem.localName;
                if (!subSelector) {
                    break;
                }
                subSelector = subSelector.toLowerCase();

                const parent = elem.parentElement;

                if (parent) {
                    const sameTagSiblings = parent.children;
                    if (sameTagSiblings.length > 1) {
                        let nameCount = 0;
                        const index = [...sameTagSiblings].findIndex((child) => {
                            if (elem.localName === child.localName) {
                                nameCount++;
                            }
                            return child === elem;
                        }) + 1;
                        if (index > 1 && nameCount > 1) {
                            subSelector += ':nth-child(' + index + ')';
                        }
                    }
                }

                path = subSelector + (path ? '>' + path : '');
                elem = parent;
            }
            return path;
        }
    </script>
    <div class="title">Status</div>
    <table id="status">
        <tr>
            <th>name</th>
            <th>value</th>
        </tr>
        <tr>
            <td>booted</td>
            <td data-name="booted"></td>
        </tr>
        <tr>
            <td>started</td>
            <td data-name="started"></td>
        </tr>
        <tr>
            <td>paused</td>
            <td data-name="paused"></td>
        </tr>
        <tr>
            <td>socket</td>
            <td data-name="socket"></td>
        </tr>
    </table>
    <hr>
    <div class="title">Controlls</div>
    <table>
        <tr>
            <td>
                <form onsubmit="return addQueue(this)">
                    <input type="text" name="queue" placeholder="Add to queue">
                    <button type="submit">Add</button>
                </form>
            </td>
            <td>
                <form onsubmit="return clickElem(this)">
                    <input type="text" name="selector" placeholder="Selector to Click">
                    <button type="submit">Click</button>
                </form>
            </td>
            <td><button onclick="socket.emit('clear queue')">Clear Queue</button></td>
            <td><button onclick="socket.emit('screen')">Screen</button></td>
            <td><button onclick="socket.emit('force check')">Force Tick Check</button></td>
            <td><button onclick="$('#logs').empty() && socket.emit('clear logs')">Clear Logs</button></td>
            <td><button onclick="socket.emit('pause server'); this.disabled = true;" id="pause_button">Pause</button></td>
            <td><button onclick="confirm('sicher?') && socket.emit('restart')">Restart Script</button></td>
            <td><button onclick="confirm('sicher (kill) ?') && socket.emit('kill')">Kill Server</button></td>
        </tr>
    </table>
    <hr>
    <div class="title">Recourses</div>
    <table>
        <tr>
            <th>wood</th>
            <th>stone</th>
            <th>iron</th>
        </tr>
        <tr>
            <td id="wood"></td>
            <td id="stone"></td>
            <td id="iron"></td>
        </tr>
    </table>
    <hr>
    <style>

    </style>
    <div class="title">Actions</div>
    <table class="tbl">
        <tr>
            <th>last tick</th>
            <th>last action</th>
            <th>next action</th>
            <th>next action time</th>
        </tr>
        <tr>
            <td id="last_tick"></td>
            <td id="last_action"></td>
            <td id="next_action"></td>
            <td id="next_action_time"></td>
        </tr>
    </table>
    <hr>
    <div class="title">Manual Queue</div>
    <ul id="queue"></ul>
    <hr>
    <div class="title">Bulding Queue</div>
    <ul id="building"></ul>
    <hr>
    <div class="title">Buildings</div>
    <table id="levels"></table>
    <hr>
    <div class="title">Screen</div>
    <img src="" id="screen">
    <hr>
    <div class="title">Content</div>
    
    <hr>
    <div class="title">Logs</div>
    <ul id="logs"></ul>
</body>

</html>